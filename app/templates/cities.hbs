<div class="cities">
  <div class="cities-detail">
    {{ui-checkbox label="Amenities" checked=showFeatures onChange=(action (mut showFeatures))}}
    {{ui-checkbox label="Investments" checked=showInvestments onChange=(action (mut showInvestments))}}
    {{ui-checkbox label="Opportunities" checked=showParcels onChange=(action (mut showParcels))}}

    <br/>

    {{#if showFeatures}}
      {{ui-checkbox label="Activating" checked=activating onChange=(action (mut activating))}}
      {{ui-checkbox label="Open" checked=featureOpen onChange=(action (mut featureOpen))}}
      {{#each assetTypeOptions as |option|}}
        {{ui-checkbox 
          label=option 
          checked=(array-contains assetTypesArray option)
          onChange=(action 'composeList' option 'assetTypes')}}
          
      {{/each}}

    {{/if}}

    {{#if showInvestments}}
      {{#each investmentTypeOptions as |option|}}
        {{ui-checkbox 
          label=option 
          checked=(array-contains investmentTypesArray option)
          onChange=(action 'composeList' option 'investmentTypes')}}
      {{/each}}
    {{/if}}

    {{#if showParcels}}
      {{ui-checkbox label="For Lease" checked=forLease onChange=(action (mut forLease))}}
      {{ui-checkbox label="For Sale" checked=forSale onChange=(action (mut forSale))}}
      {{#each landuseTypeOptions as |option|}}
        {{ui-checkbox 
          label=option 
          checked=(array-contains landuseTypesArray option)
          onChange=(action 'composeList' option 'landuseTypes')}}
      {{/each}}
    {{/if}}

    {{#leaflet-map as |layers|}}
      {{layers.tile url="http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"}}

      {{#if showFeatures}}
        {{#each visibleFeatures as |feature|}}
          {{#if feature.latitude}}
            {{#marker-layer lat=feature.latitude lng=feature.longitude opacity=0.5}}
              {{#popup-layer}}
                <h3>{{feature.name}}</h3>
                Type: {{feature.assetType}}
              {{/popup-layer}}
            {{/marker-layer}}
          {{/if}}
        {{/each}}
      {{/if}}

      {{#if showInvestments}}
        {{#each visibleInvestments as |investment|}}
          {{#if investment.latitude}}
            {{#marker-layer lat=investment.latitude lng=investment.longitude opacity=0.5}}
              {{#popup-layer}}
                <h3>{{investment.name}}</h3>
                Address: {{investment.address}}<br />
                Type: {{investment.type}}
              {{/popup-layer}}
            {{/marker-layer}}
          {{/if}}
        {{/each}}
      {{/if}}

      {{#if showParcels}}
        {{#each visibleParcels as |parcel|}}
          {{#if parcel.geom}}
            {{#polygon-layer locations=parcel.geom}}
              {{#popup-layer}}
                <h3>{{parcel.name}}</h3>
                Address: {{parcel.address}}
              {{/popup-layer}}
            {{/polygon-layer}}
          {{/if}}
        {{/each}}
      {{/if}}

      {{#each model as |city|}}
        {{#marker-layer lat=city.latitude lng=city.longitude onClick=(action 'selectCity' city)}}
        {{/marker-layer}}
      {{/each}}
    {{/leaflet-map}}
  </div>
  {{outlet}}
</div>
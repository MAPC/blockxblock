{{#ember-wormhole to="fixed-footer"}}
  <div class="link item" onclick={{action (mut isExporting) true}}>
    Export
  </div>
{{/ember-wormhole}}

{{#if isExporting}}
  {{#modal-dialog
      onClose=(action (mut isExporting) false)
      translucentOverlay=true
      as |modal|}}
    <div class="ui segment">
      <div class="ui dividing header">
        Export Current Screen
      </div>
      <div class="ui button" {{action 'export_csv' 'visibleFeatures' (array 'city' 'relatedFeature' 'open_or_closed')}}>
        Features
      </div>
      <div class="ui button" {{action 'export_csv' 'visibleInvestments' (array 'city' 'relatedInvestment' 'investment_status')}}>
        Investments
      </div>
      <div class="ui button" {{action 'export_csv' 'visibleParcels' (array 'city' 'geom' 'geojson' 'latest_is_engaged_owner' 'latest_is_for_sale' 'latest_is_for_lease' 'latest_is_vacant_lot' 'latest_ground_floor_vacancy' 'latest_upper_floor_vacancy' 'is_engaged_owner' 'is_for_sale' 'is_for_lease' 'is_vacant_lot' 'ground_floor_vacancy' 'upper_floor_vacancy' 'yearBuilt')}}>
        Parcels
      </div>
      <div class="ui secondary button" onclick={{action (mut isExporting) false}}>Close</div>
    </div>
  {{/modal-dialog}}
{{/if}}

<div class="cities ui grid">
  <div class="list-results ui segment five wide column" id="sidebar">
    <div class="city-details">
      {{outlet}}
    </div>
  </div>
  <div class="map-results {{if (not hideSidebar) 'eleven'}}{{if hideSidebar 'sixteen'}} wide column" style="padding: 0 !important; height:100%;">
    <div class="cities-map">
      <i class="large circular white {{if (not hideSidebar) 'left arrow'}} link icon sidebar-tab {{if hideSidebar 'right arrow'}}" onclick={{action 'toggleSidebar'}} style="background-color:white"></i>

      {{#main-map}}

        {{#each model as |city|}}
          {{image-layer pane='extrusions' imageUrl=city.imageOverlay bounds=city.imageOverlayBBox opacity=0.9}}
        {{/each}}

        {{#if showFeatures}}
          {{#each visibleFeatures as |feature|}}
            {{#if (and feature.latitude feature.id)}}
              {{related-investments-icon feature=feature linkTo=(action 'linkTo')}}
            {{/if}}
          {{/each}}
        {{/if}}

        {{#if showParcels}}
          {{#each visibleParcels as |parcel|}}
            {{#if parcel.geom}}
              {{#map-popup lat=parcel.latitude lng=parcel.longitude as |popup|}}
                <strong>{{parcel.ownership_type}}</strong>
                <img class="ui small image" src={{parcel.splash}}/>
                <strong>{{parcel.address}}</strong>
                {{geojson-layer geoJSON=parcel.geojson 
                                style=parcelsChoroplethMapping 
                                onClick=(action 'linkTo' 'cities.city.parcels' parcel.id)
                                onMouseover=(action popup.onMouseover)
                                onMouseout=(action popup.onMouseout)
                                pane='parcels'}}
                {{#if parcel.isSelected}}
                  {{marker-layer lat=parcel.latitude lng=parcel.longitude opacity=1}}
                {{/if}}
              {{/map-popup}}
            {{/if}}
          {{/each}}
        {{/if}}

        {{#if currentCity.isPlottingPoint}}
          {{marker-layer  lat=currentCity.newPointLatitude 
                          lng=currentCity.newPointLongitude
                          icon=(icon iconUrl='/images/add-data-pin.png' iconAnchor=(array 30 76) iconSize=(array 59 76))}}
        {{/if}}

      {{/main-map}}
      {{over-time-chart 
              selection=fake_open_or_closed 
              models=(array currentCity.city.features currentCity.city.investments)
              onEnd=(action "updateSliderDate")}}
    </div>
  </div>
</div>

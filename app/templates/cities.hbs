{{#ember-wormhole to="fixed-footer"}}
  <div class="link item" {{action 'export_csv'}}>
    Export
  </div>
{{/ember-wormhole}}
<div class="cities ui grid">
  <div class="list-results ui segment six wide column" id="sidebar">
    <div class="city-details">
      {{outlet}}
    </div>
  </div>
  <div class="map-results {{if (not hideSidebar) 'ten'}}{{if hideSidebar 'sixteen'}} wide column" style="padding: 0 !important; height:100%;">
    <div class="cities-map">
      <i class="large circular white {{if (not hideSidebar) 'left arrow'}} link icon sidebar-tab {{if hideSidebar 'right arrow'}}" onclick={{action 'toggleSidebar'}} style="background-color:white"></i>

      {{#main-map}}

        {{#if currentCity.isPlottingPoint}}
          {{marker-layer lat=currentCity.newPointLatitude lng=currentCity.newPointLongitude}}
        {{/if}}

        {{#each model as |city|}}
          {{image-layer pane='extrusions' imageUrl=city.imageOverlay bounds=city.imageOverlayBBox opacity=0.9}}
        {{/each}}

        {{#marker-cluster-layer iconCreateFunction=iconCreateFunction}}
          {{#if showInvestments}}
            {{#each visibleInvestments as |investment|}}
              {{#if (and investment.latitude investment.id)}}
                {{#map-popup lat=investment.latitude lng=investment.longitude as |popup|}}
                  <img class="ui small image" style="max-height:300px;" src={{investment.featured_photo}}/>
                  <strong>{{investment.project}}</strong>
                    {{marker-layer  
                        lat=investment.latitude 
                        lng=investment.longitude 
                        icon=(icon iconUrl=investment.iconUrl iconSize=(if investment.isSelected (array 61 61) (array 41 41)))
                        onClick=(action 'linkTo' 'cities.city.investments' investment)
                        onMouseover=(action popup.onMouseover)
                        onMouseout=(action popup.onMouseout)}}
                {{/map-popup}}
              {{/if}}
            {{/each}}
          {{/if}}
        {{/marker-cluster-layer}}

        {{!-- {{#marker-cluster-layer}} --}}
          {{#if showFeatures}}
            {{#each visibleFeatures as |feature|}}
              {{#if (and feature.latitude feature.id)}}
                {{#map-popup lat=feature.latitude lng=feature.longitude as |popup|}}
                  <strong>{{feature.feature_type}}</strong>
                  <img class="ui small image" src={{feature.splash}}/>
                  <strong>{{feature.feature_name}}</strong>
                  {{#marker-layer lat=feature.latitude 
                                  lng=feature.longitude 
                                  icon=(icon iconUrl=feature.iconUrl iconSize=(if feature.isSelected (array 35 35) (array 25 25)))
                                  onClick=(action 'linkTo' 'cities.city.features' feature)
                                  onMouseover=(action popup.onMouseover)
                                  onMouseout=(action popup.onMouseout)
                                  pane='points'}}
                  {{/marker-layer}}
                {{/map-popup}}
              {{/if}}
            {{/each}}
          {{/if}}
        {{!-- {{/marker-cluster-layer}} --}}

        {{#if showParcels}}
          {{#each visibleParcels as |parcel|}}
            {{#if parcel.geom}}
              {{#map-popup lat=parcel.latitude lng=parcel.longitude as |popup|}}
                <strong>{{parcel.ownership_type}}</strong>
                <img class="ui small image" src={{parcel.splash}}/>
                <strong>{{parcel.address}}</strong>
                {{geojson-layer geoJSON=parcel.geojson 
                                style=parcelsChoroplethMapping 
                                onClick=(action 'linkTo' 'cities.city.parcels' parcel.id)
                                onMouseover=(action popup.onMouseover)
                                onMouseout=(action popup.onMouseout)
                                pane='parcels'}}
                {{#if parcel.isSelected}}
                  {{marker-layer lat=parcel.latitude lng=parcel.longitude opacity=1}}
                {{/if}}
              {{/map-popup}}
            {{/if}}
          {{/each}}
        {{/if}}


      {{/main-map}}
      {{over-time-chart 
              selection=fake_open_or_closed 
              models=(array currentCity.city.features currentCity.city.investments)
              tooltip=true
              min=timeMin
              max=timeMax
              onEnd=(action "updateSliderDate")}}
    </div>
  </div>
</div>
